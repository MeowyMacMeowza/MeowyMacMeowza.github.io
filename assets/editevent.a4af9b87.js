import{T as I}from"./nav.2567da24.js";import{a as w}from"./amber-sad-image404.4efa4708.js";import{I as k}from"./imagecaption.0034c228.js";import{I as C}from"./NewItemCard.216c7ed1.js";import{I as y}from"./item_service.e79832af.js";import{E as g}from"./event_service.e505bfe3.js";import{f as r,k as D,g as e,t as d,h as u,w as m,z as S,v as p,F as v,p as f,i as N,A as T,j as c,r as x,o as l,m as F}from"./vendor.3cbabd63.js";import{_ as V}from"./plugin-vue_export-helper.3b9b12da.js";import"./index.23d4519d.js";const B={data(){return{user:"",message:"",loading:!1,deleting:!1,amberSad:w,success:!1,img_url:"",event_name:"",event_id:"",start_time:"",end_time:"",type:"W",fiveStar:[],fourStar:[],possibleFiveStar:[],possibleFourStar:[],searchedFive:"",searchedFour:"",dataReady:!1,typeFull:{W:"Weapon",C:"Character"}}},async mounted(){(!this.loggedIn||!JSON.parse(JSON.stringify(this.$store.state.auth.user)).admin)&&this.$router.push("/"),document.title="Editing event banner",y.searchItem({name:"",rarity:[4]}).then(a=>{this.possibleFourStar=a.data.items}).then(a=>{y.searchItem({name:"",rarity:[5]}).then(s=>{this.possibleFiveStar=s.data.items,g.getEvent(this.$route.params.event_id).then(i=>{var h=new Date;this.type=i.data.type,this.event_id=this.$route.params.event_id,this.event_name=i.data.event_name,this.img_url=i.data.img_url,this.start_time=new Date(Date.parse(i.data.start_time)-h.getTimezoneOffset()*6e4).toISOString().substring(0,16),this.end_time=new Date(Date.parse(i.data.end_time)-h.getTimezoneOffset()*6e4+1e3).toISOString().substring(0,16);for(const n of i.data.wish_pool)if(console.log(n),n.rarity==4){var t=this.possibleFourStar.find(({name:b})=>b===n.name);this.possibleFourStar=this.possibleFourStar.filter(function(b){return b.name!==t.name}),this.fourStar.push(t)}else{console.log(n);var t=this.possibleFiveStar.find(({name:_})=>_===n.name);this.possibleFiveStar=this.possibleFiveStar.filter(function(_){return _.name!==t.name}),this.fiveStar.push(t)}}).then(i=>this.dataReady=!0)})})},computed:{loggedIn(){return this.user=JSON.parse(JSON.stringify(this.$store.state.auth.user)),this.$store.state.auth.status.loggedIn},filteredFive(){return this.possibleFiveStar.filter(a=>a.type==this.typeFull[this.type]&&a.name.toLowerCase().includes(this.searchedFive.toLowerCase()))},filteredFour(){return this.possibleFourStar.filter(a=>a.type==this.typeFull[this.type]&&a.name.toLowerCase().includes(this.searchedFour.toLowerCase()))}},methods:{editEvent(){const a=s=>new Promise(i=>setTimeout(i,s));this.message="",this.loading=!0,console.log({event_name:this.event_name,type:this.type,start_time:this.start_time,end_time:this.end_time,img_url:this.img_url,fiveStars:this.fiveStar,fourStars:this.fourStar}),a(250).then(s=>{if(this.event_name.length<=0||this.event_name.length>50){this.message="Invalid Event Name",this.loading=!1;return}if(!this.start_time||!this.end_time){this.message="Invalid Duration",this.loading=!1;return}if(this.img_url.length==0){this.message="Invalid Banner Image",this.loading=!1;return}if(this.fiveStar.length==0){this.message="There are no featured 5\u2606s",this.loading=!1;return}if(this.fourStar.length==0){this.message="There are no featured 5\u2606s",this.loading=!1;return}g.editEvent({event_id:this.event_id,event_name:this.event_name,type:this.type,start_time:new Date(this.start_time).toISOString().slice(0,19).replace("T"," "),end_time:new Date(Date.parse(this.end_time)-1e3).toISOString().slice(0,19).replace("T"," "),img_url:this.img_url,wish_pool:this.fiveStar.concat(this.fourStar)}).then(i=>{this.success=!0,(t=>new Promise(n=>setTimeout(n,t)))(1500).then(t=>{this.$router.push("/event")})},i=>{this.loading=!1,this.message=i.response&&i.response.data&&i.response.data.message||i.message||i.toString()}).catch(i=>{this.loading=!1,this.message=i.response&&i.response.data&&i.response.data.message||i.message||i.toString()})})},bnrImgError(a){a.target.src=this.amberSad},removeFiveStar(a){this.fiveStar=this.fiveStar.filter(function(s){return s.name!==a.name}),this.possibleFiveStar.push(a)},removeFourStar(a){this.fourStar=this.fourStar.filter(function(s){return s.name!==a.name}),this.possibleFourStar.push(a)},addFive(a){this.fiveStar.push(a),this.possibleFiveStar=this.possibleFiveStar.filter(function(s){return s.name!==a.name})},addFour(a){this.fourStar.push(a),this.possibleFourStar=this.possibleFourStar.filter(function(s){return s.name!==a.name})},deleteEvent(){this.deleting=!0,this.message="",g.deleteEvent(this.event_id).then(a=>{this.success=!0,(i=>new Promise(h=>setTimeout(h,i)))(1e3).then(i=>{this.$router.go()})},a=>{this.deleting=!1,this.message=a.message,console.log(a.message)}).catch(a=>{this.deleting=!1,this.message=a.message,console.log(a.message)})}},watch:{type(a,s){if(!!this.dataReady){a=="W"?this.event_name="Epitome Invocation":this.event_name="";for(const i of this.fiveStar)this.possibleFiveStar.push(i);this.fiveStar=[];for(const i of this.fourStar)this.possibleFourStar.push(i);this.fourStar=[]}}},components:{TopNav:I,ImgCaption:k,ItemCard:C}},L={class:"d-flex flex-column position-relative container-xxl mt-5 px-5 pe-5 bd-layout bg-light shadow-lg rounded-3 content-body"},O=T('<div class="d-flex"><p class="my-5 fs-1 text-wrap lead grow-3 justified text-center"><b class="stylised"> Edit an Event </b></p></div><button class="position-absolute top-0 end-0 btn btn-danger py-1 px-1 me-3 mt-3 stylised-black" data-bs-target="#delEvent" data-bs-toggle="modal"><span class="material-icons align-bottom"> delete </span> Delete Event </button>',2),R={key:0,class:"alert alert-danger",role:"alert"},U={class:"d-flex mb-5"},z={class:"row grow-1 me-2 mb-auto gy-3"},W=e("div",{class:"stylised fs-4"}," Event Banner Information ",-1),A={class:"col-4"},J=e("label",{class:"form-label"}," Type of Banner ",-1),P={class:"btn-group mb-2 mx-1",role:"group","aria-label":"eventType"},M=e("label",{class:"btn btn-outline-primary",for:"charEvent"},"Character",-1),j=e("label",{class:"btn btn-outline-primary",for:"wepEvent"},"Weapon",-1),G={class:"col-12"},H=e("label",{for:"bnrName",class:"form-label"}," Banner Name ",-1),Y=["disabled"],q={class:"col-6"},K=e("label",{for:"bnrName",class:"form-label"}," Start Duration ",-1),Q={class:"col-6"},X=e("label",{for:"bnrName",class:"form-label"}," End Duration ",-1),Z=e("div",{class:"stylised fs-5 mt-5"}," Featured Items ",-1),$=e("div",{class:"d-flex"},[c(" Featured 5 \u2606 "),e("button",{class:"btn btn-primary btn-sm align-self-start stylised-black ms-auto",type:"button","data-bs-toggle":"modal","data-bs-target":"#addFiveStar"}," + ")],-1),ee=e("div",{class:"d-flex"},[c(" Featured 4 \u2606 "),e("button",{class:"btn btn-primary btn-sm align-self-start stylised-black ms-auto",type:"button","data-bs-toggle":"modal","data-bs-target":"#addFourStar"}," + ")],-1),te=e("div",{class:"vr mx-2"},null,-1),se={class:"grow-1"},oe={class:"px-3 d-flex flex-column"},ae=["src"],ie=e("p",{class:"text-center text-muted mb-5 mt-1"},"Banner Image Preview",-1),ne=e("label",{for:"bnrImg",class:"form-label mt-auto"},"Banner Image URL",-1),le={class:"d-flex"},re=e("p",{class:"mt-auto mb-5 smol-text"}," \xA9 G neshni shni \xA9 ",-1),de={class:"modal fade",id:"addFiveStar",tabindex:"-1","aria-labelledby":"addFiveStarLabel","aria-hidden":"true"},me={class:"modal-dialog"},ce={class:"modal-content"},ue={class:"modal-header"},he={class:"modal-title"},_e=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),pe={class:"modal-body"},be={class:"d-flex align-items-center mb-4"},ve={class:"me-2"},fe=["placeholder"],ge={key:0,class:"border rounded-3 modal-search"},ye={class:"my-2 mx-2 fs-5 d-flex align-items-center"},Se=["src"],xe=["onClick"],Fe=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1),Ee={class:"modal fade",id:"addFourStar",tabindex:"-1","aria-labelledby":"addFourStarLabel","aria-hidden":"true"},Ie={class:"modal-dialog"},we={class:"modal-content"},ke={class:"modal-header"},Ce={class:"modal-title"},De=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Ne={class:"modal-body"},Te={class:"d-flex align-items-center mb-4"},Ve={class:"me-2"},Be=["placeholder"],Le={key:0,class:"border rounded-3 modal-search"},Oe={class:"my-2 mx-2 fs-5 d-flex align-items-center"},Re=["src"],Ue=["onClick"],ze=e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1),We={class:"modal fade",id:"delEvent",tabindex:"-1","aria-labelledby":"deleteItem","aria-hidden":"true"},Ae={class:"modal-dialog modal-lg"},Je={class:"modal-content"},Pe=e("div",{class:"modal-header"},[e("h3",{class:"modal-title"},[e("b",null,"Hold up! Are you sure?")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Me={class:"modal-body mb-3 fs-5"},je=c(" This deletion is an "),Ge=e("b",{class:"text-danger"},"irreversible",-1),He=c(" action."),Ye=e("br",null,null,-1),qe=c(" You cannot retrieve the event "),Ke=c(" back after the deletion! "),Qe={class:"modal-footer"},Xe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1),Ze={key:1,class:"card d-flex flex-column align-items-center py-3 px-4 position-fixed top-50 start-50 translate-middle",style:{"z-index":"1060"}},$e=e("strong",{class:"mb-3"},"Editing...",-1),et=e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),tt=[$e,et],st={key:2,class:"card d-flex flex-column align-items-center py-3 px-4 position-fixed top-50 start-50 translate-middle",style:{"z-index":"1060"}},ot=e("strong",{class:"mb-3"},"Deleting...",-1),at=e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),it=[ot,at],nt={key:3},lt=e("div",{class:"card d-flex flex-column align-items-center py-4 px-5 position-fixed top-50 start-50 translate-middle",style:{"z-index":"1060"}},[e("span",{class:"material-icons text-success",style:{"font-size":"3rem"}}," task_alt "),e("strong",{class:""},"Success!")],-1),rt=[lt],dt={key:4,class:"offcanvas-backdrop fade show"};function mt(a,s,i,h,t,n){const b=x("TopNav"),_=x("ItemCard");return l(),r(v,null,[D(b),e("div",L,[O,t.message?(l(),r("div",R,d(t.message),1)):u("",!0),e("div",U,[e("div",z,[W,e("div",A,[J,e("div",P,[m(e("input",{type:"radio",class:"btn-check",id:"charEvent",autocomplete:"off",name:"eventType","onUpdate:modelValue":s[0]||(s[0]=o=>t.type=o),value:"C",checked:""},null,512),[[S,t.type]]),M,m(e("input",{type:"radio",class:"btn-check",id:"wepEvent",autocomplete:"off",name:"eventType","onUpdate:modelValue":s[1]||(s[1]=o=>t.type=o),value:"W"},null,512),[[S,t.type]]),j])]),e("div",G,[H,m(e("input",{type:"text",class:"form-control",placeholder:"Name","aria-label":"Banner Name",id:"bnrName","onUpdate:modelValue":s[2]||(s[2]=o=>t.event_name=o),disabled:t.type=="W"},null,8,Y),[[p,t.event_name]])]),e("div",q,[K,m(e("input",{type:"datetime-local",class:"form-control",placeholder:"Start Duration","aria-label":"Start Duration",id:"startDate","onUpdate:modelValue":s[3]||(s[3]=o=>t.start_time=o)},null,512),[[p,t.start_time]])]),e("div",Q,[X,m(e("input",{type:"datetime-local",class:"form-control",placeholder:"End Duration","aria-label":"End Duration",id:"endDate","onUpdate:modelValue":s[4]||(s[4]=o=>t.end_time=o)},null,512),[[p,t.end_time]])]),Z,$,(l(!0),r(v,null,f(t.fiveStar,o=>(l(),F(_,{key:o.name,item:o,onRemoveItem:n.removeFiveStar},null,8,["item","onRemoveItem"]))),128)),ee,(l(!0),r(v,null,f(t.fourStar,o=>(l(),F(_,{key:o.name,item:o,onRemoveItem:n.removeFourStar},null,8,["item","onRemoveItem"]))),128))]),te,e("div",se,[e("div",oe,[e("img",{class:"img-fluid align-self-center mx-3 mt-auto",src:t.img_url,onError:s[5]||(s[5]=(...o)=>n.bnrImgError&&n.bnrImgError(...o))},null,40,ae),ie,ne,m(e("input",{class:"form-control form-control-sm",id:"bnrImg",type:"text","onUpdate:modelValue":s[6]||(s[6]=o=>t.img_url=o)},null,512),[[p,t.img_url]])])])]),e("div",le,[e("button",{class:"ms-auto btn btn-outline-success btn-lg me-auto",onClick:s[7]||(s[7]=(...o)=>n.editEvent&&n.editEvent(...o))},"Edit Event")]),re,e("div",de,[e("div",me,[e("div",ce,[e("div",ue,[e("h5",he,"5 \u2606 "+d(t.typeFull[t.type])+"s",1),_e]),e("div",pe,[e("div",be,[e("span",ve,"Search for 5 \u2606 "+d(t.typeFull[t.type])+"s:",1),m(e("input",{class:"form-control form-control-sm grow-1",type:"text",placeholder:t.typeFull[t.type]+" Name","onUpdate:modelValue":s[8]||(s[8]=o=>t.searchedFive=o)},null,8,fe),[[p,t.searchedFive]])]),n.filteredFive.length>0?(l(),r("div",ge,[(l(!0),r(v,null,f(n.filteredFive,o=>(l(),r("div",ye,[e("img",{class:"me-3",src:o.icon_img,style:{"max-width":"80px","max-height":"80px"}},null,8,Se),c(" "+d(o.name)+" ",1),e("button",{type:"button",class:"ms-auto btn btn-success btn-sm me-2","data-bs-dismiss":"modal",onClick:E=>n.addFive(o)},"Add",8,xe)]))),256))])):u("",!0)]),Fe])])]),e("div",Ee,[e("div",Ie,[e("div",we,[e("div",ke,[e("h5",Ce,"4 \u2606 "+d(t.typeFull[t.type])+"s",1),De]),e("div",Ne,[e("div",Te,[e("span",Ve,"Search for 4 \u2606 "+d(t.typeFull[t.type])+"s:",1),m(e("input",{class:"form-control form-control-sm grow-1",type:"text",placeholder:t.typeFull[t.type]+" Name","onUpdate:modelValue":s[9]||(s[9]=o=>t.searchedFour=o)},null,8,Be),[[p,t.searchedFour]])]),n.filteredFour.length>0?(l(),r("div",Le,[(l(!0),r(v,null,f(n.filteredFour,o=>(l(),r("div",Oe,[e("img",{class:"me-3",src:o.icon_img,style:{"max-width":"80px","max-height":"80px"}},null,8,Re),c(" "+d(o.name)+" ",1),e("button",{type:"button",class:"ms-auto btn btn-success btn-sm me-2","data-bs-dismiss":"modal",onClick:E=>n.addFour(o)},"Add",8,Ue)]))),256))])):u("",!0)]),ze])])]),e("div",We,[e("div",Ae,[e("div",Je,[Pe,e("div",Me,[je,Ge,He,Ye,qe,e("code",null,[e("b",null,d(t.event_name)+" (Event ID: "+d(t.event_id)+")",1)]),Ke]),e("div",Qe,[e("button",{type:"button",class:"btn btn-danger","data-bs-dismiss":"modal",onClick:s[10]||(s[10]=N((...o)=>n.deleteEvent&&n.deleteEvent(...o),["prevent"]))},"Delete Anyways"),Xe])])])]),t.loading?(l(),r("div",Ze,tt)):u("",!0),t.deleting?(l(),r("div",st,it)):u("",!0),t.success?(l(),r("div",nt,rt)):u("",!0),t.loading||t.deleting?(l(),r("div",dt)):u("",!0)])],64)}var yt=V(B,[["render",mt]]);export{yt as default};
