import{_ as m,U as p}from"./plugin-vue_export-helper.3b9b12da.js";import{T as g}from"./nav.2567da24.js";import{f as r,g as s,t as f,h as u,w as h,v as c,i as _,j as b,o as n}from"./vendor.3cbabd63.js";const w={data(){return{message:"",success:"",loading:!1,file:null,user:JSON.parse(JSON.stringify(this.$store.state.auth.user))}},mounted(){this.$store.state.auth.status.loggedIn||this.$router.push("/")},methods:{changePfp(o){this.file=o.target.files[0],this.user.pfp_url=URL.createObjectURL(this.file),console.log(this.user)},saveChanges(){if(this.loading=!0,this.message="",this.user.username.length==0||this.user.username.length>20){this.message="Invalid username! Username must be of length 1-20.",this.loading=!1;return}if(this.user.email.length==0||this.user.email.length>50){this.message="Invalid email!",this.loading=!1;return}if(this.user.password.length==0){this.message="Empty password!",this.loading=!1;return}if(this.file!=null)console.log("test"),p.upload(this.file).then(e=>{this.user.user_id,this.user.username,this.user.email,e.data.newfile,this.user.password,this.user.newpassword&&this.user.newpassword,this.$store.dispatch("auth/edit",{user_id:this.user.user_id,username:this.user.username,email:this.user.email}).then(()=>{this.loading=!1,this.user=JSON.parse(JSON.stringify(this.$store.state.auth.user)),this.success=!0,(a=>new Promise(t=>setTimeout(t,a)))(1e3).then(a=>{this.$router.push("/user")})},l=>{this.loading=!1,this.message=l.response&&l.response.data&&l.response.data.message||l.message||l.toString()})}).catch(e=>{this.message="Could not upload the image! "+e,this.loading=!1});else{var o={user_id:this.user.user_id,username:this.user.username,email:this.user.email,password:this.user.password};this.user.newpassword&&(o.newpassword=this.user.newpassword),this.$store.dispatch("auth/edit",o).then(()=>{this.loading=!1,this.user=JSON.parse(JSON.stringify(this.$store.state.auth.user)),this.success=!0,(l=>new Promise(a=>setTimeout(a,l)))(1e3).then(l=>{this.$router.push("/user")})},e=>{this.loading=!1,this.message=e.response&&e.response.data&&e.response.data.message||e.message||e.toString()})}},discardChanges(){console.log(this.$store.state.auth.user),this.editing=!1,this.user=JSON.parse(JSON.stringify(this.$store.state.auth.user)),this.file=null}},components:{TopNav:g}},y={class:"d-flex flex-column w-75 mx-auto px-3 my-5 bg-white shadow-lg position-relative",style:{"--bs-bg-opacity":".8",padding:"3rem 5rem 3rem 5rem"}},v=s("a",{class:"position-absolute top-0 end-0 mt-5 me-5 primary-dark-text stylised-black fs-5",href:"/user"},[s("span",{class:"material-icons align-middle"}," keyboard_backspace "),b(" Go Back to Profile ")],-1),x={class:"mx-5"},k=s("h2",{class:"mb-4 stylised-black"},"Account Info",-1),N={key:0,class:"alert alert-danger",role:"alert"},S={class:"d-flex flex-column align-items-center"},C=["src"],P=s("label",{class:"mb-2",for:"pfp_url"},"Change Your Profile Picture",-1),O=["disabled"],U={class:"table table-borderless mt-5",style:{"table-layout":"fixed"}},E=s("td",{class:"align-middle fs-5",colspan:"1"},"Username",-1),J=["disabled"],T=s("td",{class:"align-middle fs-5"},"Email",-1),V=["disabled"],B=s("td",{class:"align-middle fs-5"},"New Password (Optional)",-1),I=["disabled"],L=s("br",null,null,-1),j=s("br",null,null,-1),z=s("tr",null,[s("td",{class:"fs-5"},"Confirm Your Password")],-1),D={colspan:"2"},M=["disabled"],R={key:0,class:"card d-flex flex-column align-items-center py-3 px-4 position-absolute top-50 start-50 translate-middle"},Y=s("strong",{class:"mb-3"},"Editing Profile",-1),A=s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1),G=[Y,A],q={key:1},F=s("div",{class:"card d-flex flex-column align-items-center py-4 px-5 position-fixed top-50 start-50 translate-middle",style:{"z-index":"1060"}},[s("span",{class:"material-icons text-success",style:{"font-size":"3rem"}}," task_alt "),s("strong",{class:""},"Success!")],-1),H=[F],K={key:2,class:"offcanvas-backdrop fade show"},Q=["disabled"];function W(o,e,l,a,t,d){return n(),r("div",y,[v,s("div",x,[k,t.message?(n(),r("div",N,f(t.message),1)):u("",!0),s("div",S,[s("img",{class:"img-fluid rounded-circle border border-4 border-info my-3 mb-4",src:t.user.pfp_url,width:"300",height:"300",id:"pfp"},null,8,C),P,s("input",{type:"file",class:"form-control align-middle w-50",id:"pfp_url",disabled:t.loading,accept:"image/*",onChange:e[0]||(e[0]=(...i)=>d.changePfp&&d.changePfp(...i))},null,40,O)]),s("table",U,[s("tbody",null,[s("tr",null,[E,s("td",null,[h(s("input",{type:"text",class:"form-control",id:"username",disabled:t.loading,"onUpdate:modelValue":e[1]||(e[1]=i=>t.user.username=i),placeholder:"Enter your username"},null,8,J),[[c,t.user.username]])])]),s("tr",null,[T,s("td",null,[h(s("input",{type:"email",class:"form-control",id:"email",disabled:t.loading,"onUpdate:modelValue":e[2]||(e[2]=i=>t.user.email=i),placeholder:"Enter your email"},null,8,V),[[c,t.user.email]])])]),s("tr",null,[B,s("td",null,[h(s("input",{type:"password",class:"form-control",id:"newpassword",disabled:t.loading,"onUpdate:modelValue":e[3]||(e[3]=i=>t.user.newpassword=i),placeholder:"Enter your new password"},null,8,I),[[c,t.user.newpassword]])])]),L,j,z,s("tr",null,[s("td",D,[h(s("input",{type:"password",class:"form-control",id:"confpassword",disabled:t.loading,"onUpdate:modelValue":e[4]||(e[4]=i=>t.user.password=i),placeholder:"Enter your old password"},null,8,M),[[c,t.user.password]])])])])])]),t.loading?(n(),r("div",R,G)):u("",!0),t.success?(n(),r("div",q,H)):u("",!0),t.loading||t.success?(n(),r("div",K)):u("",!0),s("button",{type:"submit",onClick:e[5]||(e[5]=_((...i)=>d.saveChanges&&d.saveChanges(...i),["prevent"])),class:"btn btn-success btn-lg mt-4 mx-auto",disabled:t.loading},"Save Changes",8,Q)])}var ss=m(w,[["render",W]]);export{ss as default};
